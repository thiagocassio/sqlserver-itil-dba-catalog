# üõ†Ô∏è 2.3.1 Falha de Jobs do SQL Server Agent
**Categoria:** Plataforma SQL Server  
**CI afetado:** SQL Server Agent / Job  
**Escopo:** Automa√ß√£o / Agendamento  
**Severidade sugerida:** P2 / P3  

---

## üéØ Objetivo

Identificar falhas na execu√ß√£o de jobs do SQL Server Agent, analisando hist√≥rico, etapas do job e poss√≠veis erros de credencial, permiss√£o ou recurso.

---

## üîé Diagn√≥stico Inicial (Quick Triage)

```sql
SELECT *
FROM msdb.dbo.sysjobs;
```
```sql
SELECT *
FROM msdb.dbo.sysjobhistory
ORDER BY run_date DESC, run_time DESC;
```
---

üß† **An√°lise por Componentes**
- **Status do Job**
```sql
SELECT 
    j.name,
    ja.run_requested_date,
    ja.stop_execution_date,
    ja.last_executed_step_id,
    ja.job_id
FROM msdb.dbo.sysjobactivity ja
JOIN msdb.dbo.sysjobs j
ON ja.job_id = j.job_id;
```
Objetivo:

- Verificar √∫ltima execu√ß√£o
- Identificar job travado

##

- **Hist√≥rico de Execu√ß√£o**
```sql
SELECT 
    j.name,
    h.run_date,
    h.run_time,
    h.run_status,
    h.message
FROM msdb.dbo.sysjobhistory h
JOIN msdb.dbo.sysjobs j
ON h.job_id = j.job_id
ORDER BY h.run_date DESC, h.run_time DESC;
```
Objetivo:

- Identificar erro espec√≠fico da etapa

##

- **Status do Servi√ßo SQL Server Agent**

PowerShell:
```PowerShell
Get-Service SQLSERVERAGENT
```
Objetivo:

- Confirmar se o servi√ßo est√° em execu√ß√£o

---

üß∞ **Ferramentas**

- SQL Server Management Studio (Job Activity Monitor)
- SQL Server Agent Logs
- Event Viewer (Application)

---

üß© **Poss√≠veis Causas**

- Servi√ßo SQL Server Agent parado
- Falha de credencial/proxy
- Permiss√£o insuficiente
- Timeout em etapa do job
- Falha em backup, ETL ou script executado

---

üõ†Ô∏è **A√ß√µes de Mitiga√ß√£o**

- Reiniciar SQL Server Agent
- Executar job manualmente para valida√ß√£o
- Revisar etapa espec√≠fica com erro
- Validar credenciais de proxy
- Corrigir script ou comando falho

---

üîÅ **Monitoramento P√≥s-Mitigation**
```sql
SELECT 
    name,
    enabled
FROM msdb.dbo.sysjobs;
```
```sql
SELECT *
FROM msdb.dbo.sysjobhistory
ORDER BY run_date DESC, run_time DESC;
```
