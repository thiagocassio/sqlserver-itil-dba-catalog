# ğŸ§  1.1.2 MemÃ³ria sob pressÃ£o
**Categoria:** Infraestrutura  
**CI afetado:** Servidor SQL / InstÃ¢ncia SQL  
**Escopo:** Engine / Sistema Operacional  
**Severidade sugerida:** P1 / P2  

---

## ğŸ¯ Objetivo

Identificar pressÃ£o de memÃ³ria no SQL Server e no Sistema Operacional, analisando grants, consumo interno e disponibilidade geral.

<br><br>

---

## ğŸ” DiagnÃ³stico Inicial (Quick Triage)

Ferramenta opcional:

```sql
EXEC sp_whoisactive;

SELECT * 
FROM sys.dm_exec_query_memory_grants;

SELECT * 
FROM sys.dm_os_process_memory;
```
<br><br>

ğŸ§  AnÃ¡lise por DMV
ğŸ”¹ Grants de MemÃ³ria Ativos
```sql
SELECT *
FROM sys.dm_exec_query_memory_grants;
```
Objetivo:

Identificar consultas aguardando memÃ³ria

Detectar RESOURCE_SEMAPHORE

<br><br>

ğŸ”¹ Consumo Interno de MemÃ³ria (Clerks)
```sql
SELECT *
FROM sys.dm_os_memory_clerks
ORDER BY pages_kb DESC;
```
Objetivo:

Identificar componentes internos com maior consumo

<br><br>

ğŸ”¹ MemÃ³ria do Processo SQL Server
```sql
SELECT *
FROM sys.dm_os_process_memory;
```
Objetivo:

Validar pressÃ£o interna da instÃ¢ncia

<br><br>

ğŸ”¹ MemÃ³ria DisponÃ­vel no Sistema Operacional
```sql
SELECT *
FROM sys.dm_os_sys_memory;
```
Objetivo:

Avaliar memÃ³ria livre no SO

Identificar pressÃ£o externa ao SQL Server

<br><br>

ğŸ–¥ï¸ PerfMon (Sistema Operacional)

Principais contadores:

SQLServer:Memory Manager\Memory Grants Pending

SQLServer:Buffer Manager\Page Life Expectancy

Memory\Available MBytes

Objetivo:

Confirmar pressÃ£o real de memÃ³ria

Diferenciar gargalo SQL vs Sistema Operacional

<br><br>

ğŸ§° ScriptDBA / Ferramentas Opcionais

Ferramenta nÃ£o nativa:

sp_whoisactive

Uso recomendado para anÃ¡lise rÃ¡pida de grants e sessÃµes.

<br><br>

ğŸ§© PossÃ­veis Causas

Consultas com alto consumo de memÃ³ria

Falta de Ã­ndices adequados

Paralelismo excessivo

ConfiguraÃ§Ã£o inadequada de Max Server Memory

PressÃ£o externa no servidor

<br><br>

ğŸ› ï¸ AÃ§Ãµes de MitigaÃ§Ã£o

Identificar sessÃµes com grants elevados

Avaliar planos de execuÃ§Ã£o

Ajustar Max Server Memory (quando necessÃ¡rio)

Revisar Ã­ndices e estatÃ­sticas

Reduzir paralelismo em consultas crÃ­ticas

<br><br>

ğŸ” Monitoramento PÃ³s-Mitigation
SELECT *
FROM sys.dm_exec_query_memory_grants;
SELECT *
FROM sys.dm_os_process_memory;
