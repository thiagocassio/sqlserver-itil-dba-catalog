# üîó 1.1.4 Excesso de conex√µes
**Categoria:** Infraestrutura  
**CI afetado:** Inst√¢ncia SQL  
**Escopo:** Engine / Conectividade  
**Severidade sugerida:** P2  

---

## üéØ Objetivo

Identificar excesso de conex√µes simult√¢neas que possam impactar consumo de recursos, concorr√™ncia e estabilidade da inst√¢ncia SQL Server.

---

## üîé Diagn√≥stico Inicial (Quick Triage)

Ferramenta opcional:

- EXEC sp_whoisactive;
```sql
SELECT *
FROM sys.dm_exec_sessions;
```
```sql
SELECT *
FROM sys.dm_exec_connections;
```

---

üß† **An√°lise por DMV**
- **Sess√µes Ativas**
```sql
SELECT *
FROM sys.dm_exec_sessions
WHERE is_user_process = 1;
```
Objetivo:
- Identificar volume de conex√µes abertas
- Detectar sess√µes inativas

##

- **Conex√µes Estabelecidas**
```sql
SELECT *
FROM sys.dm_exec_connections;
```

Objetivo:
- Validar origem das conex√µes
- Identificar aplica√ß√µes dominantes

##

- **Performance Counters**
```sql
SELECT *
FROM sys.dm_os_performance_counters
WHERE counter_name = 'User Connections';
```
Objetivo:

- Monitorar crescimento de conex√µes

--- 

üñ•Ô∏è **PerfMon (Sistema Operacional)**

Principais contadores:
- SQLServer:General Statistics\User Connections
- SQLServer:SQL Statistics\Batch Requests/sec
- Process(sqlservr)\Handle Count
<br>
Objetivo:

- Avaliar impacto real das conex√µes na inst√¢ncia

---

üß∞ **ScriptDBA / Ferramentas Opcionais**

Ferramenta n√£o nativa:

- sp_whoisactive

Uso recomendado para visualizar conex√µes por aplica√ß√£o.

---

üß© **Poss√≠veis Causas**

- Pool de conex√µes mal configurado
- Aplica√ß√µes sem controle de sess√£o
- Reconex√µes constantes
- Falta de timeout na aplica√ß√£o
- Servi√ßos externos realizando polling excessivo

---

üõ†Ô∏è **A√ß√µes de Mitiga√ß√£o**

- Identificar aplica√ß√£o com maior volume de conex√µes
- Ajustar pool de conex√µes
- Encerrar sess√µes √≥rf√£s
- Revisar configura√ß√£o de timeout
- Avaliar limites de conex√£o

---

üîÅ **Monitoramento P√≥s-Mitigation**
```sql
SELECT *
FROM sys.dm_exec_sessions
WHERE is_user_process = 1;
```
```sql
SELECT *
FROM sys.dm_os_performance_counters
WHERE counter_name = 'User Connections';
```
