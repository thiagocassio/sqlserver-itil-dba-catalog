# üìâ 1.2.2 Falta de espa√ßo em disco
**Categoria:** Infraestrutura  
**CI afetado:** Volume Data / Volume Log / TempDB  
**Escopo:** Arquivos MDF / NDF / LDF  
**Severidade sugerida:** P1 / P2  

---

## üéØ Objetivo

Identificar consumo excessivo de espa√ßo em disco que possa comprometer opera√ß√µes do SQL Server, incluindo crescimento de datafiles, transaction log e TempDB.

---

## üîé Diagn√≥stico Inicial (Quick Triage)

Ferramenta opcional:

- EXEC sp_whoisactive;
```sql
SELECT name, size, max_size, growth
FROM sys.database_files;
DBCC SQLPERF(LOGSPACE);
```

---

üß† **An√°lise por DMV**
- **Arquivos do Banco de Dados**
```sql
SELECT 
    name,
    size * 8 / 1024 AS SizeMB,
    max_size,
    growth
FROM sys.database_files;
```
Objetivo:

- Verificar crescimento e limites dos arquivos

##

- **Consumo de Transaction Log**
- DBCC SQLPERF(LOGSPACE);

Objetivo:

- Identificar bancos com log pr√≥ximo do limite

##

- **TempDB**
```sql
SELECT *
FROM tempdb.sys.database_files;
```
Objetivo:

- Validar crescimento inesperado da TempDB

---

üñ•Ô∏è **PerfMon (Sistema Operacional)**

Principais contadores:

- LogicalDisk% Free Space

- LogicalDisk\Free Megabytes

<br>
Objetivo:

- Confirmar n√≠vel cr√≠tico de espa√ßo dispon√≠vel

---

üß∞ **ScriptDBA / Ferramentas Opcionais**

Ferramenta n√£o nativa:

- sp_whoisactive

Uso recomendado para identificar sess√µes consumindo espa√ßo excessivo.

---

üß© **Poss√≠veis Causas**

- Crescimento descontrolado de transaction log
- Falta de rotina de backup de log
- √çndices grandes ou fragmentados
- Queries com uso intenso de TempDB
- Arquivos configurados com autogrowth inadequado

---

üõ†Ô∏è **A√ß√µes de Mitiga√ß√£o**

- Realizar backup do transaction log
- Avaliar limpeza de dados hist√≥ricos
- Ajustar tamanho inicial dos arquivos
- Revisar estrat√©gia de autogrowth
- Verificar consultas que utilizam TempDB intensivamente

---

üîÅ **Monitoramento P√≥s-Mitigation**
```sql
SELECT name, size * 8 / 1024 AS SizeMB
FROM sys.database_files;
```
```sql
DBCC SQLPERF(LOGSPACE);
```
